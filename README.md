# KDT_RE_5th_Machine_Project

> **태양광·풍력으로 생산한 전기를 PyTorch AI가 실시간 분석·예측해,
제한된 에너지 안에서 식물이 가장 잘 자랄 수 있는 환경을 자동으로 유지하는 시스템**
> 

| 항목 | 내용 |
| --- | --- |
| 프로젝트명 | 재생에너지 기반 AI 스마트팜 에너지 최적화 및 발전량 예측 시스템 |
| 팀 구성 | 이수빈 (팀장) · 백동윤 (팀원) · 김정현 (팀원) |
| 핵심 기술 | PyTorch LSTM · 규칙 기반 제어(Rule-based) · Flask · Arduino UNO · Chart.js |

---

## 목차

1. 프로젝트 개요
2. 시스템 구조
3. 하드웨어 구성
4. AI 모델 설계
5. 데이터 수집 및 전처리
6. Flask 서버 및 웹 대시보드
7. 구현 일정
8. 리스크 및 대응 방안
9. 기대 효과 및 확장 가능성
10. 협업 규칙

---

## 1. 프로젝트 개요

### 1.1 연구 배경 및 필요성

재생에너지는 탄소 중립 실현의 핵심 기술이지만, 태양광과 풍력은 기상 조건에 따라 발전량이 크게 변동하는 근본적인 한계를 안고 있다. 맑은 날 오후에는 최대 출력을 내다가도 흐린 날이나 야간에는 발전량이 0에 가까워진다. 소형 스마트팜 환경에서 이 전력 불안정은 식물 생장 환경(조명·온습도)에 직접적인 타격을 주어 작물 품질 저하로 이어질 수 있다.

기존 스마트팜 시스템은 두 가지 구조적 문제를 가진다.

- **전력 의존성** — 화석연료 기반 외부 전기를 사용해 탄소를 발생시킴
- **단순 자동화** — `if 건조하면 물 줌` 수준의 규칙 기반 제어로, 배터리 잔량이 5%밖에 없어도 LED를 100%로 켜는 등 에너지 상황을 전혀 반영하지 못함

본 프로젝트는 이 두 문제를 동시에 해결한다. 소형 태양광·풍력 하이브리드 발전 시스템을 직접 구축하고, PyTorch LSTM으로 발전량을 예측하며, AI가 에너지 상황과 식물 환경 데이터를 종합 분석해 LED 밝기·에너지 모드를 자동 최적화한다.

### 1.2 단순 IoT와의 차별점

| 구분 | 단순 IoT 자동화 | 본 프로젝트 (AI 기반) |
| --- | --- | --- |
| 판단 방식 | 단일 조건 규칙 (`if`) | 다변수 종합 분석 |
| 에너지 고려 | 없음 | SOC·발전량·예측값 모두 반영 |
| 미래 대응 | 불가능 | LSTM으로 1시간 후 발전량 단기 예측 |
| 배터리 5% 상황 | LED 100% 켬 → 시스템 사망 | LED 31%로 줄이고 배터리 보호 |
| 흐린 날 연속 예측 | 불가능 | 선제적으로 절전 모드 전환 |

### 1.3 프로젝트 목표

| # | 목표 |
| --- | --- |
| 1 | 태양광·풍력 하이브리드 발전 시스템 구축 + INA219 실시간 발전량 측정 |
| 2 | PyTorch LSTM 시계열 모델로 향후 1시간 발전량 단기 예측 |
| 3 | 규칙 기반 제어가 에너지·환경 데이터 반영 → LED 밝기·에너지 모드 결정 |
| 4 | 토양습도 기반 이진분류 급수 알림 시스템 |
| 5 | Flask + Chart.js 실시간 웹 대시보드 통합 모니터링 |

### 1.4 팀 구성 및 역할

| 역할 | 담당자 | 주요 업무 | 보조 업무 |
| --- | --- | --- | --- |
| 하드웨어 | 백동윤 | 태양광·풍력 발전 시스템 구축, 센서 연결·보정, 아두이노 펌웨어 개발 | 회로 설계, 부품 구매 |
| AI | 이수빈 | 데이터 전처리, PyTorch 모델 설계·학습·성능 평가, AI 추론 서버 연동 | EDA 분석, Flask AI 연동 |
| 웹 | 김정현 | Flask 서버 구축, CSV 데이터 관리, 실시간 대시보드 개발 (Chart.js) | API 설계, 배포 |

---

## 2. 시스템 구조

### 2.1 전체 데이터 흐름

```
[ 발전 ]  ☀️ 태양광 패널 (9~12V)  +  💨 풍력 발전기
                    ↓  1N4007 다이오드 (역전류 방지)
               [BMS 2S]  과충전·과방전·단락 보호
                    ↓
  🔋 18650 배터리 ×2 직렬 (7.4V)  ←  SOC 실시간 계산 (분압저항 A0)

[ 제어 ]  🤖 Arduino UNO R3
           INA219 (발전량 W)  ·  분압저항 (SOC %)
           DHT11 (온도·공기습도)  ·  LDR (조도 %)
           토양습도 센서 (흙 수분 %)
                    ↓  WiFi (ESP-01)  JSON 5초 전송

[ AI ]    💻 Flask 서버 (Python)
           ① LSTM  → 1시간 후 발전량 단기 예측
           ② 규칙 기반 제어 → LED 밝기 · 에너지 모드 결정
           ③ 분류  → 급수 알림 (0/1)
                    ↓  LED 밝기 · 모드 명령 반환

[ 출력 ]  💡 LED 어레이 (트랜지스터 PWM 제어)
          📊 실시간 웹 대시보드
```

### 2.2 시스템 아키텍처 계층도

| 계층 | 구성 요소 | 역할 |
| --- | --- | --- |
| **발전·저장층** | 태양광 + 풍력 + BMS + 18650×2 | 에너지 생산 및 저장 |
| **센서·제어층** | 아두이노 + 센서 5종 + LED | 환경 측정 및 물리 제어 |
| **통신층** | ESP-01 WiFi + JSON | 데이터 무선 전송 |
| **AI 추론층** | Flask + PyTorch 2모델 + 규칙 기반 제어 | 예측 + 규칙 기반 판단 및 명령 |
| **시각화층** | Chart.js 대시보드 | 모니터링 및 알림 |

### 2.3 에너지 3단계 모드

**규칙 기반 제어 로직**이 SOC를 기반으로 에너지 모드를 결정하고, 조도·발전량(및 필요 시 LSTM 예측값)을 추가로 고려해 LED 밝기를 조절한다.

| 모드 | SOC 조건 | LED 밝기 | 세부 동작 |
| --- | --- | --- | --- |
| 🔴 긴급절전 (0) | SOC < 20% | 50 (20%) | 배터리 보호 최우선, 최소 기능만 유지 |
| 🟡 절약 (1) | SOC 20~60% | 150 (59%) | 기본은 중간 밝기 유지, 조도 상황에 따라 추가 감광 |
| 🟢 풀가동 (2) | SOC ≥ 60% | 220 (86%) | 충분한 SOC에서 생장 환경 우선, 필요 시 최대치로 상향 |

**SOC 계산 공식:**

```
SOC (%) = (현재전압 − 6.0) / (8.4 − 6.0) × 100

완전 방전: 6.0V → 0%   완전 충전: 8.4V → 100%
예시: 7.4V → (7.4 − 6.0) / 2.4 × 100 = 58.3%
```

---

## 3. 하드웨어 구성

### 3.1 발전부 및 ESS

| 부품 | 사양 | 역할 |
| --- | --- | --- |
| 태양광 패널 | 9~12V | 주력 발전원 (맑은 날 최대 출력) |
| 소형 풍력 발전기 | 5~12V | 보조 발전원 (흐린 날·야간 보완) |
| 1N4007 다이오드 ×2 | 1A / 1000V | 역전류 방지, 두 발전원 간섭 차단 |
| BMS 2S 모듈 | 과충전 4.2V / 과방전 3.0V | 배터리 보호 (과충전·과방전·단락) |
| 18650 배터리 ×2 직렬 | 3.7V × 2 = 7.4V | 전력 저장 |
| INA219 모듈 | I2C (A4/A5) | 발전 전압·전류 동시 측정 → 발전량(W) |
| 분압저항 (10kΩ×2) | A0 핀 연결 | 7.4V → 3.7V로 낮춰 안전 측정 |

> **INA219 측정 원리:** 발전량(W) = 전압(V) × 전류(A). 약 1,500원짜리 I2C 모듈로 두 값을 동시에 정밀 측정한다.
> 

### 3.2 센서 및 핀 배치

| 센서 / 모듈 | 핀 | 측정 항목 | 비고 |
| --- | --- | --- | --- |
| DHT11 | D2 | 온도 (°C) / 공기습도 (%) | 풀업저항 10kΩ 권장 |
| ESP-01 RX | D3 | WiFi 수신 | 분압저항 필수 (5V→3.3V) |
| ESP-01 TX | D4 | WiFi 송신 | SoftwareSerial |
| LED PWM | D6 | 식물 조명 밝기 (0~255) | PWM 핀만 가능 |
| SOC 분압 | A0 | 배터리 전압 | 10kΩ + 10kΩ 분압 |
| LDR 조도 | A1 | 빛의 양 (%) | 10kΩ 풀다운저항 |
| 토양습도 | A2 | 흙 수분 (%) | 300(촉촉)~1023(건조) |
| INA219 SDA | A4 | I2C 데이터 | Wire 라이브러리 |
| INA219 SCL | A5 | I2C 클럭 | Wire 라이브러리 |

### 3.3 LED 조명 제어 회로

아두이노 핀은 최대 40mA를 공급할 수 있어 LED 5개(약 100mA)를 직접 구동하지 못한다. **2N2222 트랜지스터**로 전류를 증폭해 배터리에서 직접 LED에 전류를 공급하고, 아두이노 D6(PWM)으로 밝기를 제어한다.

```
배터리 5V ──────────────→ LED 어레이 (+)
                                ↓
                         트랜지스터 2N2222 컬렉터 (C)
D6 (PWM) → [1kΩ 저항] → 트랜지스터 베이스 (B)
                         트랜지스터 이미터 (E) → GND

analogWrite(6, 0~255) 로 밝기 단계 조절
```

### 3.4 하드웨어 구매 체크리스트

| 분류 | 부품 | 수량 | 비고 |
| --- | --- | --- | --- |
| 발전 | 소형 풍력 발전기 | 1 | DC-DC 컨버터 권장 |
| 저장 | 18650 배터리 + 홀더 | 2 | 2000mAh 이상 |
| 저장 | BMS 2S 모듈 | 1 | 과충전·방전 보호 |
| 측정 | INA219 모듈 | 1 | 발전량 측정 |
| 측정 | 1N4007 다이오드 | 2 | 역전류 방지 |
| 센서 | 토양습도 센서 | 1 | 급수 알림 핵심 |
| 제어 | 2N2222 트랜지스터 | 1 | LED 전류 증폭 |
| 제어 | 고휘도 백색 LED | 5 | 식물 조명 |
| 재배 | 상추 씨앗 + 화분 + 배양토 | 1세트 |  |

---

## 4. AI 모델 설계

### 4.1 모델 구성 전략

한 달 프로젝트 기간과 하드웨어 제약을 고려해, **딥러닝 모델은 핵심 가치가 큰 발전량 예측(LSTM)과 급수 알림(이진분류)에 집중**하고, **제어 로직(LED 밝기·에너지 모드)은 규칙 기반(Rule-based)으로 단순화**한다.

| 구성 | 방식 | 입력 변수 | 출력 |
| --- | --- | --- | --- |
| ① LSTM 발전량 예측 | LSTM 1층(경량) + FC | 과거 60분 시계열 (핵심 변수 중심) | 1시간 후 발전량 (W) |
| ② 규칙 기반 에너지 제어 | Rule-based (if-else + 임계값) | 발전량·SOC·조도·온도·습도·토양 | LED 밝기 + 에너지 모드 |
| ③ 이진분류 급수 알림 | Linear 4→16→8→1 + Sigmoid | SOC·토양습도·온도·공기습도 | 급수 필요 확률 (0~1) |

### 4.2 모델 ① — LSTM 발전량 예측

**목표:** 과거 60분의 데이터 흐름을 기억해 **향후 1시간 발전량을 단기 예측**하고, 에너지 모드 전환/LED 제어를 *선제적으로* 보조

LSTM은 시계열 데이터의 패턴을 기억하는 구조다. 일반 신경망이 "지금 이 순간"만 보는 것과 달리, LSTM은 "지난 60분 동안 조도가 계속 올라갔으니 앞으로도 발전량이 증가할 것"과 같은 추세를 학습한다.

**입력 데이터 (7개 변수, 60분 시퀀스):**

| 변수 | 단위 | 출처 | 선택 이유 |
| --- | --- | --- | --- |
| 발전 전압 | V | INA219 | 태양광 출력 전압 변화 |
| 발전 전류 | A | INA219 | 실제 전력 흐름 |
| 발전 전력 | W | 전압×전류 | 직접 예측 대상 |
| 조도 | % | LDR | 태양광 발전의 핵심 변수 |
| 온도 | °C | DHT11 | 패널 효율에 영향 |
| 공기습도 | % | DHT11 | 구름·날씨 간접 지표 |
| 시간 | 0~23 | 시스템 | 시간대별 발전 패턴 학습 |

**학습 설정:**

| 항목 | 설정값 | 선택 이유 |
| --- | --- | --- |
| 손실 함수 | MSELoss | 연속값 예측, 큰 오차에 더 민감하게 반응 |
| 옵티마이저 | Adam (lr=0.001) | 시계열에 적합, 학습률 자동 조절 |
| hidden_size | 32 | 1시간 단기 예측에 맞춘 경량화 (속도·일반화 균형) |
| num_layers | 1 | 데이터 규모/기간을 고려해 구조 단순화 |
| Dropout | 0 (미적용) | LSTM 1층 구성에서는 dropout 적용 효과가 제한적이므로 제거 |
| 배치 크기 | 32 | 메모리·속도 균형 |
| 에포크 | 200 + Early Stopping | 과적합 방지, 학습 시간 단축 |
| 평가 지표 | MAE · RMSE · R² | 다각도 정확도 평가 |

**모델 구조:**

```python
class PowerPredictionLSTM(nn.Module):
    def __init__(self, input_size=7, hidden_size=32, num_layers=1, output_size=1):
        super().__init__()
        self.lstm = nn.LSTM(input_size, hidden_size, num_layers,
                            batch_first=True, dropout=0.0)
        self.fc = nn.Sequential(
            nn.Linear(hidden_size, 32), nn.ReLU(),
            nn.Linear(32, output_size)   # 1시간 후 발전량 예측
        )
    def forward(self, x):
        out, _ = self.lstm(x, (h0, c0))
        return self.fc(out[:, -1, :])    # 마지막 시점만 FC 통과
```

### 4.3 모델 ② — 규칙 기반 에너지 제어 (Rule-based)

**목표:** 현재 에너지·환경 상태를 보고 **LED 밝기와 에너지 모드를 실시간 결정**

딥러닝(MLP) 대신 **임계값 기반 규칙(if-else)** 로직으로 제어해, 구현 난이도와 하드웨어 최적화 부담을 낮춘다. LSTM 예측값(선택 적용)과 SOC를 함께 고려해 선제적 절전 전환도 가능하게 설계한다.

**규칙 예시(초안):**

```python
def decide_led_mode(soc, light, pred_1h=None):
    # 기본: SOC 기반 3단계
    if soc < 20:
        mode = 0  # 긴급절전
        led = 80
    elif soc < 60:
        mode = 1  # 절약
        led = 180 if light < 40 else 80
    else:
        mode = 2  # 풀가동
        led = 255 if light < 50 else 120

    # (선택) 1시간 뒤 발전량이 낮게 예측되면 한 단계 절전
    if pred_1h is not None and pred_1h < 1.0 and mode > 0:
        mode -= 1
        led = int(led * 0.7)

    return led, mode
```

**구현 포인트:**

- 규칙은 주차별로 1~2회만 수정(변경 이력 기록)
- LED는 PWM(0~255), 모드는 0/1/2로 고정해 통신/펌웨어 단순화
- (선택) 예측값 기반 선제 절전은 발표 포인트로 활용 가능

### 4.4 모델 ③ — 이진분류 급수 알림

**목표:** 토양습도·에너지 상황을 종합 분석해 급수 필요 여부를 0~1 확률로 판단

Sigmoid 활성화 함수를 마지막에 적용해 어떤 입력이든 0~1 사이의 확률값으로 변환한다. 0.5 이상이면 "급수 필요"로 판단해 대시보드에 알림을 표시한다.

| 조건 | 출력 | 대시보드 표시 |
| --- | --- | --- |
| 토양습도 ≥ 40% | 0 (정상) | ✅ 식물 상태 양호 |
| 토양습도 < 40%, SOC ≥ 20% | 1 (급수 필요) | 💧 물 공급 필요! |
| 토양습도 < 40%, SOC < 20% | 1 + 에너지 경고 | 💧 물 필요 + ⚡ 에너지 부족 |

**모델 구조:**

```
입력 (4) → Linear(16) → ReLU
         → Linear(8)  → ReLU
         → Linear(1)  → Sigmoid → 출력: 급수 확률 (0~1)
```

---

## 5. 데이터 수집 및 전처리

### 5.1 수집 데이터 구조

아두이노가 5초마다 JSON 형식으로 Flask 서버에 전송하면, 서버가 CSV 파일에 자동 저장한다.

| 컬럼명 | 타입 | 설명 | 범위 |
| --- | --- | --- | --- |
| timestamp | string | 측정 시각 | YYYY-MM-DD HH:MM:SS |
| temp | float | 온도 (°C) | 0~50 |
| hum | float | 공기습도 (%) | 0~100 |
| power | float | 발전량 (W) | 0~15 |
| soc | float | 배터리 SOC (%) | 0~100 |
| light | int | 조도 (%) | 0~100 |
| soil | int | 토양습도 (%) | 0~100 |
| led | int | LED 밝기 (규칙 기반) | 0~255 |
| mode | int | 에너지 모드 (규칙 기반) | 0/1/2 |

### 5.2 데이터 전처리 파이프라인

```
① 결측값 처리
   NaN 행 제거 (dropna)
   DHT11 오류값(999, -999) 필터링

② 이상값 제거
   발전량 < 0 → 0으로 대체
   SOC 0~100 범위 밖 → 클리핑

③ 정규화 (MinMaxScaler)
   모든 변수를 0~1 범위로 통일
   스케일러 .pkl 파일로 저장 (추론 시 역변환에 필요)

④ 시퀀스 생성 (LSTM용)
   슬라이딩 윈도우: 60개 연속 데이터 → 1개 샘플
   (N−60−h)개 샘플 생성 (h=1시간 예측 시, 데이터 주기에 맞춰 라벨 시프트)
   예: 5초 주기 수집이라면 1시간 ahead = 3600/5 = 720 step 뒤 값을 라벨로 사용

⑤ 학습/검증 분리
   시간 순서 유지하며 8:2 분할
   (섞으면 미래 데이터로 과거를 예측하는 데이터 누출 발생)
```

### 5.3 EDA 분석 항목

2주차에 수집된 데이터를 분석해 패턴을 파악하고 모델 설계 방향을 검증한다.

| 분석 항목 | 시각화 방법 | 확인 목적 |
| --- | --- | --- |
| 시간대별 발전량 패턴 | 시간별 평균 막대 그래프 | 오전/오후 발전 피크 확인 |
| SOC 충·방전 추이 | 시계열 꺾은선 그래프 | 에너지 모드 전환 시점 파악 |
| 조도 vs 발전량 상관관계 | 산점도 + 회귀선 | LSTM 핵심 입력 변수 확인 |
| 토양습도 변화 추이 | 시계열 + 급수 임계선 | 급수 빈도 및 패턴 파악 |
| 특성 간 상관계수 | 히트맵 | 다중공선성 및 유효 변수 선별 |
| 에너지 모드 분포 | 파이 차트 | 각 모드 발생 빈도 확인 |

---

## 6. Flask 서버 및 웹 대시보드

### 6.1 서버 아키텍처

```
아두이노 (JSON POST)
      ↓
Flask /sensor 엔드포인트
      ├── CSV 저장 (farm_data.csv)
      ├── AI 추론 (PyTorch 3모델)
      └── 응답: {led, mode, water_alert}
      ↓
아두이노 → LED 즉시 적용

브라우저 (5초 주기 fetch)
      ↓
Flask /data  → 최근 100개 데이터
Flask /stats → 탄소 절감량·운영 통계
Flask /      → dashboard.html
```

### 6.2 Flask API 엔드포인트

| URL | 메소드 | 역할 | 응답 형식 |
| --- | --- | --- | --- |
| `/sensor` | POST | 센서 수신 → CSV 저장 → AI 추론 → LED 명령 반환 | `{led, mode, water_alert}` |
| `/data` | GET | 최근 100개 센서 데이터 | JSON 배열 |
| `/predict` | GET | LSTM 발전량 예측 결과 (1h) | `{pred_1h}` |
| `/stats` | GET | 탄소 절감량·평균 SOC·운영 일수 | `{carbon_g, avg_soc, days}` |
| `/` | GET | 대시보드 메인 페이지 | HTML |

### 6.3 웹 대시보드 구성

| 영역 | 표시 내용 | 갱신 주기 |
| --- | --- | --- |
| 상태 바 | 실시간 깜빡이는 점 + 에너지 모드 배지 | 5초 |
| 실시간 카드 (6개) | 발전량(W) · SOC(%) · 조도(%) · 온도(°C) · 공기습도(%) · 토양습도(%) | 5초 |
| 에너지 배지 | 🟢 풀가동 / 🟡 절약 / 🔴 긴급절전 | 5초 |
| 차트 ① | 실제 발전량 vs LSTM 예측 발전량 비교 (점선) | 30초 |
| 차트 ② | 배터리 SOC 충·방전 추이 | 30초 |
| 차트 ③ | AI 결정 LED 밝기 이력 | 30초 |
| 차트 ④ | 토양습도 추이 + 급수 임계선(40%) 표시 | 30초 |
| 알림 배너 | 💧 물 공급 필요 / ⚡ 에너지 부족 (조건 시 자동 표시) | 실시간 |
| 탄소 절감 통계 | 총 절감량 (g CO₂) · 운영 일수 · 평균 SOC | 1분 |

### 6.4 소프트웨어 구현 체크리스트

| 단계 | 작업 항목 | 담당 |
| --- | --- | --- |
| 환경 구성 | Python (Flask, PyTorch, pandas, sklearn, matplotlib) | 전체 |
| 환경 구성 | 아두이노 라이브러리 (DHT, Adafruit_INA219, SoftwareSerial) | 하드웨어 |
| 1~2주차 | Flask 서버 기본 구조 + CSV 저장 + `/sensor` 엔드포인트 | 웹 |
| 1~2주차 | 아두이노 펌웨어 (센서 읽기 + ESP-01 전송 + LED 수신) | 하드웨어 |
| 3주차 | 데이터 전처리 파이프라인 (정규화, 시퀀스 생성) | AI |
| 3주차 | LSTM 모델 학습 + 검증 + `.pth` 저장 | AI |
| 3주차 | 규칙 기반 에너지 제어 로직 설계·튜닝 (임계값/시나리오 테스트) | AI + 하드웨어 |
| 3주차 | 이진분류 급수 알림 모델 학습 | AI |
| 4주차 | Flask AI 추론 연동 + LED 명령 전송 | AI + 웹 |
| 4주차 | 웹 대시보드 완성 (실시간 카드 + Chart.js 4종) | 웹 |
| 4주차 | 성능 평가 (MAE · RMSE · R² · 정확도) + 발표 PPT | 전체 |

---

## 7. 구현 일정

### 7.1 주차별 상세 일정

| 주차 | 담당 | 주요 작업 | 완료 기준 |
| --- | --- | --- | --- |
| **1주차** 기획·구매 | 전체 | 부품 구매, 개발 환경 구성, 역할 분담 확정, Git 레포 세팅, 회로 설계 초안 작성 | 부품 전체 수령 + Git 레포 구성 완료 |
| **2주차** 하드웨어 | 하드웨어 | BMS·배터리·아두이노 회로 연결, INA219·DHT11·토양습도·LDR 테스트, LED 트랜지스터 회로, ESP-01 WiFi 연동 | 시리얼 모니터 센서값 정상 출력 |
| **2주차** 서버 초기 | 웹 | Flask 기본 구조, CSV 저장, `/sensor` 엔드포인트, 아두이노 → 서버 데이터 수신 확인 | 아두이노 → 서버 수신 + CSV 쌓임 확인 |
| **3주차** 데이터 | 전체 | 24시간+ 연속 데이터 수집, EDA 분석 6종, 발전 패턴 시각화, 라벨 자동 생성 | CSV 300개+ + EDA 그래프 6종 완성 |
| **3주차** AI/제어 설계 | AI | LSTM 발전량 예측 학습, 급수 분류 모델 학습, 규칙 기반 에너지 제어 로직 튜닝 | Loss 수렴 확인 + `.pth` 2개 저장 + 제어 규칙 버전 1.0 확정 |
| **4주차** 통합 | 전체 | Flask AI 추론 연동, 실시간 LED 제어 테스트, 웹 대시보드 완성 (Chart.js 4종) | AI 명령 → LED 제어 정상 작동 |
| **4주차** 마무리 | 전체 | 성능 평가 (MAE · RMSE · R² · 정확도), 발표 PPT, 최종 보고서, 상추 수확 | 발표 자료 완성 + 수확 사진 🥬 |

### 7.2 마일스톤

```
Week 1  ████░░░░░░░░  기획·구매·환경 구성
Week 2  ░░░░████░░░░  하드웨어 + 서버 기초
Week 3  ░░░░░░░░████  데이터 수집 + AI 학습
Week 4  ░░░░░░░░░░██  통합·평가·발표
```

---

## 8. 리스크 및 대응 방안

### 8.1 하드웨어 리스크

| 예상 문제 | 원인 | 대응 방안 |
| --- | --- | --- |
| 풍력 발전량 거의 0 | 실내 바람 부족 | 선풍기로 인위적 바람 생성. 부족 시 가변저항으로 발전 시뮬레이션 |
| 배터리 충전 안 됨 | 태양광 전압 미달 | 9V 이상 패널 필수. 5V 패널은 BMS 충전 전압 미달로 충전 불가 |
| ESP-01 WiFi 불안정 | 3.3V 전류 부족 | 아두이노 3.3V 핀 대신 별도 3.3V 레귤레이터 사용. RX 핀 분압저항 필수 |
| DHT11 NaN 출력 | 신호선 불안정 | DATA 핀과 5V 사이 10kΩ 풀업저항 추가 |
| 토양센서 값 튐 | 부식 또는 접촉 불량 | 실험 직전 꽂기, 장기 노출 금지, 캐패시터 방식 센서로 교체 고려 |

### 8.2 소프트웨어 리스크

| 예상 문제 | 원인 | 대응 방안 |
| --- | --- | --- |
| 데이터 수집량 부족 | LSTM 최소 1주일치 필요 | 24시간 연속 수집 필수. 부족 시 공개 기상 데이터셋 혼합 학습 |
| LSTM 예측 정확도 낮음 | 실내/소형 발전 환경에서 데이터 변동성이 낮거나, 수집 기간이 짧아 일반화가 어려움 | 예측 범위를 1시간 단기로 제한해 불확실성 축소. 예측값은 제어 보조 신호로만 사용(보수적 절전). Early Stopping 적용 |
| AI 모델 과적합 | 데이터 적고 모델이 상대적으로 복잡 | 모델 경량화(1층 LSTM, hidden 축소), Early Stopping (patience=20), 필요 시 간단한 노이즈 증강 |
| AI가 조연으로 밀릴 위험 | 하드웨어에 시간 과소비 | 하드웨어는 2주차까지 반드시 완료. 3~4주차는 AI·대시보드에만 집중 |

---

## 9. 기대 효과 및 확장 가능성

### 9.1 기술적 기대 효과

| 효과 | 내용 |
| --- | --- |
| 딥러닝 3모델 실증 | PyTorch LSTM (시계열 예측) + MLP (최적화) + 이진분류 — 하나의 시스템에서 동시 구현 |
| IoT 파이프라인 완성 | 아두이노 → WiFi → Flask → AI → 대시보드 실시간 루프 |
| 에너지 안정화 | LSTM 예측으로 선제적 절전 전환 → 배터리 과방전 방지 |
| 탄소 절감 | 외부 전기 사용량 0, 자가발전만으로 시스템 운영 |

### 9.2 향후 확장 방향

| 방향 | 내용 |
| --- | --- |
| 기상청 API 연동 | 외부 날씨 예보를 LSTM 입력에 추가 → 예측 정확도 대폭 향상 |
| 강화학습 (RL) 적용 | 에너지 분배를 더욱 동적으로 최적화 |
| 카메라 + 머신비전 | 식물 생장 이미지 분석 → 생장 속도·이상 감지 |
| 수직 농장 확장 | 다층 LED 제어, 다수 화분 관리 |
| 독립형 전력 시스템 | 캠핑, 산간 오지 등 외부 전기 없는 환경 적용 |

---

## 10. 협업 규칙

### 10.1 커밋 컨벤션

**형식:** `type: 간결한 요약`

| 타입 | 의미 | 예시 |
| --- | --- | --- |
| `feat` | 새 기능 추가 | `feat: LSTM 발전량 예측 모델 추가` |
| `fix` | 버그 수정 | `fix: SOC 계산 분압 오류 수정` |
| `data` | 데이터 관련 | `data: 3일차 센서 데이터 추가` |
| `docs` | 문서 수정 | `docs: README 회로도 업데이트` |
| `refactor` | 코드 개선 | `refactor: Flask 라우터 구조 정리` |
| `test` | 테스트 코드 | `test: LSTM 정확도 검증 스크립트 추가` |
| `chore` | 실험·임시 코드 | `chore: 하이퍼파라미터 튜닝 실험` |

### 10.2 브랜치 전략

```
main        ← 최종 발표용 (직접 push 금지)
  └─ dev    ← 통합 브랜치 (PR 후 머지)
       ├─ feature/lstm-model
       ├─ feature/rule-based-controller
       ├─ feature/water-classifier
       ├─ feature/flask-api
       └─ feature/dashboard
```

- PR 기반 운영, **팀원 2명 리뷰 후** 머지
- 한 커밋 = 한 가지 작업 단위 (여러 변경은 여러 커밋으로 분리)

### 10.3 그라운드 룰

**의사소통**

- 결정사항·이슈는 구두보다 Slack / Notion 채널에 문서로 기록
- 질문 시 "현상 / 재현 방법 / 로그 / 시도한 것" 네 가지 함께 남기기

**작업 방식**

- 이슈는 먼저 "무엇 / 완료 조건"을 정의한 뒤 진행 상태 업데이트
- 하드웨어 변경(배선·부품·펌웨어)은 반드시 변경 내역 + 테스트 결과 기록

**코드·데이터 관리**

- API 키·토큰 등 민감정보는 절대 저장소에 커밋하지 않기 (`.env` 사용)
- 데이터 버전 관리: 수집 기간 · 센서 구성 · 이상값 처리 방법 기록 필수
- 학습 완료된 `.pth` 파일과 스케일러 `.pkl` 파일은 `models/` 폴더에 보관

**회의·결정**

- 회의 후 24시간 내 결정사항 · 액션아이템 · 담당자 · 기한 업데이트
